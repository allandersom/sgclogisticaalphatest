<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <title>SGC Log√≠stica - Rota di√°ria</title>
    <link rel="icon" type="image/png" href="images.png">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-slate-50 text-slate-800 antialiased overflow-hidden">

    <!-- Login -->
    <div id="login-screen" class="fixed inset-0 z-[10000] bg-slate-900 flex flex-col items-center justify-center p-6">
        <div class="w-full max-w-sm bg-white rounded-2xl shadow-2xl p-8 text-center animate-fade-in">
            <!-- LOGO ALTERADA AQUI -->
            <img src="images.png" alt="SGC Logo" class="w-24 h-24 mx-auto mb-6 object-contain drop-shadow-xl">
            
            <h2 class="text-2xl font-bold text-slate-800 mb-6">SGC Log√≠stica</h2>
            <input type="password" id="login-pass" class="w-full input-modern text-center text-lg font-bold mb-4" placeholder="Senha" onkeypress="if(event.key === 'Enter') Auth.check()">
            <button onclick="Auth.check()" class="w-full bg-slate-900 text-white font-bold py-3 rounded-xl">Entrar</button>
            <p id="login-error" class="text-red-500 text-xs font-bold mt-4 hidden">Senha Incorreta</p>
        </div>
    </div>
    
    <!-- Loaders & Toast -->
    <div id="toast-container" class="fixed top-6 right-6 z-[9999] flex flex-col gap-3 pointer-events-none"></div>
    <div id="loading-overlay" class="fixed inset-0 z-[9998] bg-slate-900/90 backdrop-blur-md hidden flex-col items-center justify-center">
        <div class="modern-spinner"><div class="spinner-core"></div><div class="spinner-ring"></div></div>
        <span class="mt-8 text-sm font-bold tracking-[0.2em] uppercase text-white animate-pulse">Calculando Rotas...</span>
    </div>

    <!-- Modais -->
    <div id="paste-modal" class="hidden fixed inset-0 z-[10005] modal-backdrop flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden animate-fade-in">
            <div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50"><h3 class="font-bold">üìã Prancheta Inteligente</h3><button onclick="UI.toggleModal('paste-modal')"><i class="fas fa-times"></i></button></div>
            <div class="p-6 space-y-4">
                <div class="bg-blue-50 text-blue-700 p-3 rounded text-xs border border-blue-200">
                    <i class="fas fa-magic mr-1"></i> O sistema identifica automaticamente:<br>
                    <b>EMPRESA:</b> Nome, <b>OBRA:</b> Local, <b>END:</b> Endere√ßo.
                </div>
                <textarea id="paste-area" rows="8" class="input-modern font-mono text-xs" placeholder="Exemplo:
EMPRESA: Construtora A
OBRA: Edif√≠cio Solar
END: Rua da Aurora, 123
..."></textarea>
                <button onclick="App.processSmartPaste()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-lg">Processar Lista</button>
            </div>
        </div>
    </div>

    <div id="disposal-modal" class="hidden fixed inset-0 z-[10005] modal-backdrop flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full animate-fade-in">
            <div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-green-50"><h3 class="font-bold text-green-800">‚ôªÔ∏è Gerenciar Aterros</h3><button onclick="UI.toggleModal('disposal-modal')"><i class="fas fa-times"></i></button></div>
            <div class="p-6 space-y-4">
                <div class="space-y-2">
                    <input id="new-aterro-name" type="text" class="input-modern" placeholder="Nome do Aterro">
                    <input id="new-aterro-addr" type="text" class="input-modern" placeholder="Endere√ßo ou Link GPS">
                    <button onclick="App.addDisposalPoint()" class="w-full bg-green-600 text-white font-bold py-2 rounded-lg text-xs">Salvar Novo Local</button>
                </div>
                <div class="h-px bg-slate-100"></div>
                <div id="disposal-list" class="space-y-2 max-h-40 overflow-y-auto custom-scroll"></div>
            </div>
        </div>
    </div>

    <div id="select-disposal-modal" class="hidden fixed inset-0 z-[10006] modal-backdrop flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full animate-fade-in">
            <div class="p-4 border-b border-slate-100 flex justify-between bg-slate-50"><h3 class="font-bold text-sm">Onde descartar nesta viagem?</h3><button onclick="UI.toggleModal('select-disposal-modal')"><i class="fas fa-times"></i></button></div>
            <div id="select-disposal-list" class="p-2 space-y-1 max-h-60 overflow-y-auto"></div>
            <div class="p-2 border-t border-slate-100"><button onclick="App.clearTripDisposal()" class="w-full text-red-500 text-xs font-bold py-2">Remover Descarte</button></div>
        </div>
    </div>

    <div id="settings-modal" class="hidden fixed inset-0 z-[10001] modal-backdrop flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full animate-fade-in">
            <div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center"><h3 class="font-bold">Configura√ß√µes</h3><button onclick="UI.toggleModal('settings-modal')"><i class="fas fa-times"></i></button></div>
            <div class="p-6 space-y-3">
                <button onclick="UI.toggleModal('disposal-modal'); UI.toggleModal('settings-modal')" class="action-list-btn group"><div class="icon-box bg-green-50 text-green-600"><i class="fas fa-dumpster"></i></div><div class="font-semibold text-xs">Gerenciar Aterros</div></button>
                <div class="flex gap-2">
                    <button onclick="DataService.export()" class="action-list-btn group flex-1"><div class="icon-box bg-blue-50 text-blue-600"><i class="fas fa-download"></i></div><div class="font-semibold text-xs">Backup</div></button>
                    <button onclick="document.getElementById('file-upload').click()" class="action-list-btn group flex-1"><div class="icon-box bg-emerald-50 text-emerald-600"><i class="fas fa-upload"></i></div><div class="font-semibold text-xs">Restaurar</div></button>
                    <input type="file" id="file-upload" class="hidden" accept=".json" onchange="DataService.import(this)">
                </div>
                <button onclick="DataService.reset()" class="action-list-btn group hover:border-red-200"><div class="icon-box bg-red-50 text-red-500"><i class="fas fa-trash-alt"></i></div><div class="font-semibold text-sm text-red-600">Iniciar Novo Dia</div></button>
                <button onclick="Auth.logout()" class="w-full text-xs text-slate-400 mt-2 underline">Sair</button>
            </div>
        </div>
    </div>

    <!-- App Main -->
    <div id="app-wrapper" class="flex h-screen w-screen overflow-hidden relative filter blur-sm transition-all duration-500">
        <button onclick="UI.toggleSidebar()" class="md:hidden fixed top-4 left-4 z-[500] w-12 h-12 bg-white rounded-full shadow-xl flex items-center justify-center text-slate-700 border border-slate-200"><i class="fas fa-bars"></i></button>

        <aside id="sidebar" class="fixed md:static inset-y-0 left-0 bg-white flex flex-col z-[600] transition-transform duration-300 transform -translate-x-full md:translate-x-0 shadow-2xl w-[85vw] md:w-[380px] border-r border-slate-200">
            <div class="px-5 py-4 border-b border-slate-100 flex items-center justify-between shrink-0 z-20 bg-white">
                <div class="flex items-center gap-3">
                    <img id="app-logo" src="images.png" alt="Logo" class="h-10 w-auto object-contain">
                    <div><h1 class="font-bold text-slate-900 leading-tight">SGC Log√≠stica</h1><span class="text-[9px] bg-emerald-100 text-emerald-600 px-1.5 py-0.5 rounded font-bold">Rota di√°ria</span></div>
                </div>
                <div class="flex gap-2">
                    <button onclick="UI.toggleSidebarExpand()" class="w-8 h-8 rounded-lg text-slate-400 hover:bg-slate-50"><i id="btn-expand-icon" class="fas fa-expand"></i></button>
                    <button onclick="UI.toggleModal('settings-modal')" class="w-8 h-8 rounded-lg text-slate-400 hover:bg-slate-50"><i class="fas fa-cog"></i></button>
                    <button onclick="UI.toggleSidebar()" class="md:hidden w-8 h-8 rounded-lg text-red-400"><i class="fas fa-times"></i></button>
                </div>
            </div>

            <div class="flex-grow overflow-y-auto custom-scroll relative bg-white">
                <div class="border-b border-slate-100">
                    <button onclick="UI.toggleSection('planning')" class="accordion-header group">
                        <div class="flex items-center gap-3"><div class="accordion-icon bg-blue-50 text-blue-600"><i class="fas fa-map-location-dot"></i></div><span class="font-bold text-sm text-slate-800">Operacional</span></div><i id="arrow-planning" class="fas fa-chevron-down text-slate-300 text-xs"></i>
                    </button>
                    <div id="section-planning" class="accordion-body hidden bg-slate-50/30">
                        <div class="p-4 space-y-4">
                            <div class="bg-slate-100 p-1 rounded-lg flex shadow-inner"><button onclick="App.setShift('day')" id="shift-day" class="shift-btn active">üåû Dia</button><button onclick="App.setShift('night')" id="shift-night" class="shift-btn">üåô Noite</button></div>
                            <div id="drivers-grid" class="grid grid-cols-2 gap-2"></div>
                            
                            <!-- Editor -->
                            <div id="editor-panel" class="hidden bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden animate-slide-up">
                                <div class="bg-slate-800 px-4 py-3 text-white flex justify-between items-center">
                                    <div class="flex items-center gap-2"><i class="fas fa-user-circle"></i><span id="editor-driver-name" class="font-bold text-xs uppercase">Motorista</span></div>
                                    <button onclick="UI.closeEditor()" class="text-slate-400 hover:text-white"><i class="fas fa-times"></i></button>
                                </div>
                                <div class="p-4 space-y-3">
                                    <div class="flex gap-2">
                                        <div class="flex-1 bg-slate-50 border border-slate-100 rounded-lg px-3 py-2 flex items-center gap-2 overflow-hidden">
                                            <i class="fas fa-map-pin text-slate-400 text-xs"></i><div class="truncate"><span class="block text-[8px] text-slate-400 uppercase font-bold">Origem</span><strong id="editor-origin" class="text-slate-700 text-xs truncate">Base</strong></div>
                                        </div>
                                        <input id="input-plate" type="text" class="w-20 text-center font-mono font-bold uppercase text-slate-700 border border-slate-200 rounded-lg text-xs" placeholder="PLACA" maxlength="8" onchange="App.updatePlate()">
                                    </div>
                                    <button onclick="UI.toggleModal('paste-modal')" class="w-full py-2 bg-indigo-50 text-indigo-600 border border-indigo-200 rounded-lg text-xs font-bold flex items-center justify-center gap-2"><i class="fas fa-paste"></i> Prancheta (Importar)</button>
                                    
                                    <div id="form-single" class="space-y-3">
                                        <div class="space-y-2 relative">
                                            <input id="input-empresa" type="text" class="input-modern" placeholder="Empresa" oninput="App.handleAutocomplete(this)">
                                            <input id="input-obra" type="text" class="input-modern" placeholder="Obra" oninput="App.handleAutocomplete(this)">
                                            <div id="suggestions-box" class="hidden absolute left-0 right-0 z-50 bg-white border border-slate-200 rounded-lg shadow-xl max-h-48 overflow-y-auto custom-scroll mt-1"></div>
                                        </div>
                                        <div class="flex gap-3 items-center">
                                            <input id="input-qty" type="number" value="1" min="1" class="w-16 h-10 text-center font-bold text-lg bg-slate-50 border border-slate-200 rounded-lg">
                                            <div class="flex-grow grid grid-cols-4 gap-2">
                                                <button onclick="UI.selectType('troca')" id="btn-type-troca" class="type-sel active">T</button>
                                                <button onclick="UI.selectType('colocacao')" id="btn-type-colocacao" class="type-sel">C</button>
                                                <button onclick="UI.selectType('retirada')" id="btn-type-retirada" class="type-sel">R</button>
                                                <button onclick="UI.selectType('encher')" id="btn-type-encher" class="type-sel">E</button>
                                            </div>
                                        </div>
                                        <div class="space-y-2">
                                            <div class="relative"><input id="input-dest" type="text" class="input-modern pl-9" placeholder="Endere√ßo..." onkeypress="if(event.key === 'Enter') App.addRoute()"><i class="fas fa-search absolute left-3 top-3 text-slate-400 text-xs"></i></div>
                                            <input id="input-obs" type="text" class="input-modern bg-amber-50/30 text-xs" placeholder="Obs">
                                        </div>
                                        
                                        <!-- AREA DE BOT√ïES -->
                                        <div class="flex gap-2">
                                            <button onclick="App.addToQueue()" class="flex-1 bg-blue-100 hover:bg-blue-200 text-blue-700 border border-blue-200 font-bold py-3 rounded-lg shadow-sm flex items-center justify-center gap-2 text-sm" title="Adicionar √† fila para salvar depois"><i class="fas fa-plus"></i> Fila</button>
                                            <button onclick="App.addRoute()" class="flex-1 bg-slate-900 text-white font-bold py-3 rounded-lg shadow-md flex items-center justify-center gap-2 text-sm"><i class="fas fa-check"></i> Adicionar</button>
                                        </div>
                                        
                                        <!-- VISUALIZA√á√ÉO DA FILA -->
                                        <div id="queue-container" class="hidden mt-3 bg-blue-50 border border-blue-200 rounded-lg p-3">
                                            <div class="flex justify-between items-center mb-2">
                                                <h4 class="text-[10px] font-bold text-blue-700 uppercase">Fila de Adi√ß√£o</h4>
                                                <span id="queue-count" class="text-[10px] bg-blue-600 text-white px-2 py-0.5 rounded-full font-bold">0</span>
                                            </div>
                                            <div id="queue-list" class="space-y-1 max-h-32 overflow-y-auto custom-scroll mb-2"></div>
                                            <button onclick="App.processQueue()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded text-xs shadow-lg animate-pulse">PROCESSAR FILA</button>
                                        </div>
                                    </div>

                                    <div class="pt-2 border-t border-slate-100">
                                        <div class="flex justify-between items-center mb-2"><p class="text-[9px] font-bold text-slate-400 uppercase">Hoje</p><p class="text-[9px] text-blue-500 cursor-pointer" onclick="UI.toggleSection('list')">Ver tudo</p></div>
                                        <div id="mini-history" class="space-y-1 max-h-24 overflow-y-auto custom-scroll"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="border-b border-slate-100">
                    <button onclick="UI.toggleSection('list')" class="accordion-header group">
                        <div class="flex items-center gap-3"><div class="accordion-icon bg-indigo-50 text-indigo-600"><i class="fas fa-clipboard-list"></i></div><span class="font-bold text-sm text-slate-800">Monitoramento</span></div><i id="arrow-list" class="fas fa-chevron-down text-slate-300 text-xs"></i>
                    </button>
                    <div id="section-list" class="accordion-body hidden bg-slate-50/30"><div class="p-4"><div id="monitoring-list" class="space-y-3"></div></div></div>
                </div>

                <div class="border-b border-slate-100">
                    <button onclick="UI.toggleSection('db')" class="accordion-header group">
                        <div class="flex items-center gap-3"><div class="accordion-icon bg-cyan-50 text-cyan-600"><i class="fas fa-database"></i></div><span class="font-bold text-sm text-slate-800">Banco de Endere√ßos</span></div><i id="arrow-db" class="fas fa-chevron-down text-slate-300 text-xs"></i>
                    </button>
                    <div id="section-db" class="accordion-body hidden bg-slate-50/30">
                        <div class="p-4 space-y-4">
                            <div class="space-y-2">
                                <input id="db-company" type="text" class="input-modern" placeholder="Empresa">
                                <input id="db-name" type="text" class="input-modern" placeholder="Obra">
                                <input id="db-addr" type="text" class="input-modern" placeholder="Endere√ßo">
                                <button onclick="App.addToAddressBook()" class="w-full bg-cyan-600 text-white font-bold py-2 rounded-lg text-xs">Salvar</button>
                            </div>
                            <div class="pt-2 border-t border-slate-200"><div id="db-list" class="space-y-2 max-h-48 overflow-y-auto custom-scroll"></div></div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <div id="sidebar-backdrop" onclick="UI.toggleSidebar()" class="fixed inset-0 bg-slate-900/60 z-[550] hidden md:hidden glass-backdrop backdrop-blur-sm"></div>

        <main id="map-wrapper" class="flex-grow h-full w-full bg-slate-200 relative">
            <div id="map" class="w-full h-full z-0 outline-none"></div>
            <div class="absolute bottom-8 right-6 md:top-6 md:right-6 md:bottom-auto z-[400] flex flex-col gap-3 items-end">
                <button id="fab-summary" onclick="WhatsappService.shareGeneralSummary()" class="hidden w-12 h-12 md:w-10 md:h-10 bg-emerald-500 hover:bg-emerald-600 text-white rounded-full shadow-xl flex items-center justify-center transition hover:scale-110"><i class="fab fa-whatsapp text-xl"></i></button>
                <button onclick="UI.map.setView([CONFIG.geoBase.lat, CONFIG.geoBase.lon], 13)" class="w-12 h-12 md:w-10 md:h-10 bg-white rounded-xl shadow-xl flex items-center justify-center text-slate-600 hover:text-blue-600"><i class="fas fa-location-crosshairs text-lg"></i></button>
            </div>
        </main>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="script.js"></script>
</body>
</html>



